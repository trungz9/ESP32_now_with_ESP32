Láº§n lÆ°á»£t káº¿t ná»‘i tá»«ng ESP32 qua cá»•ng USB

Náº¡p code tÆ°Æ¡ng á»©ng cho tá»«ng con (báº¡n cÃ³ thá»ƒ dÃ¹ng cÃ¹ng code, chá»‰ thay giÃ¡ trá»‹ peer_mac Ä‘á»ƒ trá» Ä‘áº¿n con cÃ²n láº¡i).

Sau khi náº¡p xong, rÃºt USB, cáº¥p nguá»“n (qua pin hoáº·c adapter), lÃ  chÃºng cÃ³ thá»ƒ tá»± nÃ³i chuyá»‡n vá»›i nhau.    


ğŸ§© Giai Ä‘oáº¡n 1: Chuáº©n bá»‹
âš™ï¸ Cáº§n cÃ³:

2 bo ESP32 DevKit (vÃ­ dá»¥ ESP32-WROOM-32 hoáº·c tÆ°Æ¡ng tá»±).

1 cÃ¡p USB Ä‘á»ƒ ná»‘i ESP32 vá»›i mÃ¡y tÃ­nh (cÃ³ thá»ƒ dÃ¹ng 1 cÃ¡p, cáº¯m láº§n lÆ°á»£t tá»«ng con).

Thonny IDE (Ä‘Ã£ cÃ i MicroPython).

ğŸªª Giai Ä‘oáº¡n 2: Láº¥y Ä‘á»‹a chá»‰ MAC cá»§a tá»«ng ESP32
ğŸ”¹ BÆ°á»›c 1: Cáº¯m ESP32 A vÃ o mÃ¡y tÃ­nh

Má»Ÿ Thonny

Chá»n Ä‘Ãºng cá»•ng káº¿t ná»‘i (Menu: Run â†’ Select interpreter â†’ MicroPython (ESP32) â†’ chá»n cá»•ng COM).

ğŸ”¹ BÆ°á»›c 2: GÃµ Ä‘oáº¡n code sau vÃ o cá»­a sá»• Shell (hoáº·c má»Ÿ file má»›i, nháº¥n Run):
import network
sta = network.WLAN(network.STA_IF)
sta.active(True)
print(sta.config('mac'))


â¡ï¸ Káº¿t quáº£ hiá»‡n ra dáº¡ng nhÆ°:

b'\x24\x6F\x28\xAA\xBB\xCC'


ğŸ“Œ ÄÃ¢y lÃ  Ä‘á»‹a chá»‰ MAC cá»§a ESP32 A â€” ghi láº¡i cáº©n tháº­n (copy cáº£ dÃ£y kÃ½ tá»± nÃ y).

ğŸ”¹ BÆ°á»›c 3: Ngáº¯t ESP32 A ra khá»i mÃ¡y tÃ­nh.
ğŸ”¹ BÆ°á»›c 4: Cáº¯m ESP32 B vÃ o mÃ¡y tÃ­nh

LÃ m láº¡i y há»‡t cÃ¡c bÆ°á»›c trÃªn Ä‘á»ƒ in ra Ä‘á»‹a chá»‰ MAC cá»§a ESP32 B.

Káº¿t quáº£ vÃ­ dá»¥:

b'\x24\x6F\x28\xDD\xEE\xFF'


ğŸ“Œ Ghi láº¡i Ä‘á»‹a chá»‰ MAC nÃ y â€” Ä‘Ã¢y lÃ  MAC cá»§a ESP32 B.

ğŸ§  Giai Ä‘oáº¡n 3: Náº¡p code cho tá»«ng ESP32
ğŸ”¸ ESP32 A

Cáº¯m láº¡i ESP32 A vÃ o mÃ¡y tÃ­nh.

Má»Ÿ Thonny, táº¡o file má»›i.

DÃ¡n Ä‘oáº¡n code sau (Ä‘Ã£ thay peer_mac báº±ng MAC cá»§a ESP32 B):

import network
import aioespnow
import asyncio
import time

sta = network.WLAN(network.STA_IF)
sta.active(True)
sta.config(channel=1)
sta.disconnect()

e = aioespnow.AIOESPNow()
e.active(True)

# ğŸ§­ Äá»‹a chá»‰ MAC cá»§a ESP32 B
peer_mac = b'\x24\x6F\x28\xDD\xEE\xFF'
e.add_peer(peer_mac)

async def send_messages():
    count = 0
    while True:
        msg = f"Hello from ESP32 A #{count}"
        await e.asend(peer_mac, msg)
        print("A sent:", msg)
        count += 1
        await asyncio.sleep(1)

async def receive_messages():
    async for mac, msg in e:
        print("A received:", mac, msg)

async def main():
    await asyncio.gather(send_messages(), receive_messages())

asyncio.run(main())


LÆ°u láº¡i vÃ o ESP32 báº±ng:

File â†’ Save asâ€¦ â†’ MicroPython device â†’ Ä‘áº·t tÃªn: main.py

RÃºt ESP32 A ra khá»i mÃ¡y tÃ­nh.

ğŸ”¸ ESP32 B

Cáº¯m ESP32 B vÃ o mÃ¡y tÃ­nh.

Má»Ÿ Thonny, táº¡o file má»›i.

DÃ¡n Ä‘oáº¡n code (thay peer_mac báº±ng MAC cá»§a ESP32 A):

import network
import aioespnow
import asyncio
import time

sta = network.WLAN(network.STA_IF)
sta.active(True)
sta.config(channel=1)
sta.disconnect()

e = aioespnow.AIOESPNow()
e.active(True)

# ğŸ§­ Äá»‹a chá»‰ MAC cá»§a ESP32 A
peer_mac = b'\x24\x6F\x28\xAA\xBB\xCC'
e.add_peer(peer_mac)

async def send_messages():
    count = 0
    while True:
        msg = f"Hello from ESP32 B #{count}"
        await e.asend(peer_mac, msg)
        print("B sent:", msg)
        count += 1
        await asyncio.sleep(1)

async def receive_messages():
    async for mac, msg in e:
        print("B received:", mac, msg)

async def main():
    await asyncio.gather(send_messages(), receive_messages())

asyncio.run(main())


Save as â†’ MicroPython device â†’ main.py

RÃºt ESP32 B ra.

âš¡ Giai Ä‘oáº¡n 4: Cháº¡y thá»­

Cáº¥p nguá»“n (USB hoáº·c 5V) cho cáº£ hai ESP32.

Má»—i con sáº½ tá»± Ä‘á»™ng cháº¡y main.py.

Cáº£ hai sáº½ gá»­i vÃ  nháº­n tin nháº¯n qua ESP-NOW.

Náº¿u báº¡n muá»‘n xem log:

Cáº¯m láº¡i tá»«ng con vÃ o Thonny â†’ nháº¥n â€œStop/Restart backendâ€ â†’ sáº½ tháº¥y tin nháº¯n qua láº¡i nhÆ°:

A sent: Hello from ESP32 A #0
A received: b'\x24\x6f\x28\xdd\xee\xff' Hello from ESP32 B #0
